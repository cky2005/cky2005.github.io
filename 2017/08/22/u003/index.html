<!-- build time:Mon Aug 28 2017 19:32:42 GMT+0800 (中国标准时间) --><!DOCTYPE HTML><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="chrome=1"><title>用密匙登陆服务器 | 无名小站</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="author" content="(^_^)"><meta name="description" content="ROOT用户关闭密码登陆方式，更换为 Key密匙方式登陆。"><meta name="description" content="ROOT用户关闭密码登陆方式，更换为 Key密匙方式登陆。"><meta name="keywords" content="vps"><meta property="og:type" content="article"><meta property="og:title" content="用密匙登陆服务器"><meta property="og:url" content="http://cky2005.github.com/2017/08/22/u003/index.html"><meta property="og:site_name" content="无名小站"><meta property="og:description" content="ROOT用户关闭密码登陆方式，更换为 Key密匙方式登陆。"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2017-08-22T14:12:56.038Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="用密匙登陆服务器"><meta name="twitter:description" content="ROOT用户关闭密码登陆方式，更换为 Key密匙方式登陆。"><link rel="icon" type="image/x-icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"></head></html><body><div class="wrapper"><header id="header"><div class="title"><h1><a href="/">无名小站</a></h1><p><a href="/">缘来系你</a></p></div><nav class="nav"><ul><li><a href="/">首页</a></li><li><a href="/archives">档案</a></li></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div class="content"><article class="post"><header><div class="icon"></div><a href="/2017/08/22/u003/"><time datetime="2017-08-22T13:23:00.000Z">2017-08-22</time></a><h1 class="title">用密匙登陆服务器</h1></header><div class="entry"><p>ROOT用户关闭密码登陆方式，更换为 Key密匙方式登陆。<a id="more"></a>其他非ROOT用户也差不多，不过 公私/私匙 的位置就变了。<br>同时也可以多个服务器共有一个密匙，也避免服务器太多分不清。<br>为了服务器安全，推荐：非22端口+Key密匙登陆+Key密匙密码，这样搭配最安全。</p><h4 id="首先确保你的系统安装了-openssl"><a href="#首先确保你的系统安装了-openssl" class="headerlink" title="首先确保你的系统安装了 openssl"></a>首先确保你的系统安装了 openssl</h4><figure class="highlight php"><table><tr><td class="code"><pre><div class="line">openssl -V</div><div class="line"><span class="comment"># 正常情况下会返回一大串内容，</span></div><div class="line"><span class="comment"># 如果提示 -bash: openssl: command not found 则代表未安装，用下面的命令安装：</span></div><div class="line"><span class="comment"># CentOS 系统：</span></div><div class="line">yum install openssl -y</div><div class="line"><span class="comment"># Debian/Ubuntu 系统</span></div><div class="line">apt-get install openssl -y</div></pre></td></tr></table></figure><h4 id="生成密匙对"><a href="#生成密匙对" class="headerlink" title="生成密匙对"></a>生成密匙对</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">ssh-keygen</div></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><div class="line">Generating <span class="keyword">public</span>/<span class="keyword">private</span> rsa key pair.</div><div class="line"> </div><div class="line">Enter file in which to save the key (/root/.ssh/id_rsa):</div><div class="line"><span class="comment"># 输入要保存的密匙文件位置，直接回车 默认即可</span></div><div class="line"><span class="comment">#</span></div><div class="line">Created directory <span class="string">'/root/.ssh'</span>.</div><div class="line"><span class="comment"># </span></div><div class="line">Enter passphrase (<span class="keyword">empty</span> <span class="keyword">for</span> no passphrase):</div><div class="line"><span class="comment"># 输入密匙的密码,可直接回车留空,也可以输入密码来进一步增强安全性(密匙+密码双重保险)</span></div><div class="line">Enter same passphrase again:</div><div class="line"><span class="comment"># 重复输入一次密匙的密码</span></div><div class="line"><span class="comment"># </span></div><div class="line">Your identification has been saved in /root/.ssh/id_rsa.</div><div class="line"><span class="comment"># 你的私匙位置 /root/.ssh/id_rsa</span></div><div class="line">Your <span class="keyword">public</span> key has been saved in /root/.ssh/id_rsa.pub.</div><div class="line"><span class="comment"># 你的公匙位置 /root/.ssh/id_rsa.pub</span></div><div class="line"><span class="comment"># </span></div><div class="line">The key fingerprint is:</div><div class="line"><span class="number">7</span>c:<span class="number">25</span>:bd:<span class="number">54</span>:f5:fc:<span class="number">60</span>:c0:<span class="number">86</span>:c1:a0:<span class="number">32</span>:<span class="number">7</span>d:<span class="number">8</span>a:<span class="number">80</span>:c4 root@debian</div><div class="line">The key<span class="string">'s randomart image is:</span></div><div class="line"><span class="string">+--[ RSA 2048]----+</span></div><div class="line"><span class="string">|        .o.+..o..|</span></div><div class="line"><span class="string">| o   . .  o o+ o.|</span></div><div class="line"><span class="string">|. E o . .  .o + o|</span></div><div class="line"><span class="string">| .   + +   o o o.|</span></div><div class="line"><span class="string">|    . . S .   . .|</span></div><div class="line"><span class="string">|         .       |</span></div><div class="line"><span class="string">|        .        |</span></div><div class="line"><span class="string">|                 |</span></div><div class="line"><span class="string">|                 |</span></div><div class="line"><span class="string">+-----------------+</span></div></pre></td></tr></table></figure><h4 id="配置服务器公匙"><a href="#配置服务器公匙" class="headerlink" title="配置服务器公匙"></a>配置服务器公匙</h4><figure class="highlight php"><table><tr><td class="code"><pre><div class="line">cd .ssh</div><div class="line"><span class="comment"># 进入 .ssh 目录</span></div><div class="line"><span class="comment"># </span></div><div class="line">ls -a</div><div class="line"><span class="comment"># . .. id_rsa id_rsa.pub</span></div><div class="line"><span class="comment"># 查看当前文件夹(/root/.ssh/)下的公匙(id_rsa.pub)和私匙(id_rsa)</span></div><div class="line"><span class="comment"># </span></div><div class="line">mv id_rsa.pub authorized_keys</div><div class="line"><span class="comment"># 重命名公匙(id_rsa.pub)</span></div><div class="line"><span class="comment"># </span></div><div class="line">ls -a</div><div class="line"><span class="comment"># . .. authorized_keys id_rsa</span></div><div class="line"><span class="comment"># 再查看一次当前文件夹(/root/.ssh/)下的公匙是否重命名成功</span></div><div class="line"><span class="comment"># </span></div><div class="line">chmod <span class="number">600</span> authorized_keys</div><div class="line">chmod <span class="number">700</span> ~/.ssh</div><div class="line"><span class="comment"># 然后修改密匙文件的权限，避免被其他用户 修改/删除。</span></div><div class="line"><span class="comment"># chmod 600 - 只有属主有读写权限。</span></div><div class="line"><span class="comment"># chmod 700 - 只有属主有读、写、执行权限。</span></div></pre></td></tr></table></figure><h4 id="配置SSH-需要开启-Key密匙登陆选项（一般默认都是开启的）"><a href="#配置SSH-需要开启-Key密匙登陆选项（一般默认都是开启的）" class="headerlink" title="配置SSH,需要开启 Key密匙登陆选项（一般默认都是开启的）"></a>配置SSH,需要开启 Key密匙登陆选项（一般默认都是开启的）</h4><p>打开配置文件<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">vi /etc/ssh/sshd_config</div></pre></td></tr></table></figure><p></p><p>找到下面几个参数：<br></p><figure class="highlight php"><table><tr><td class="code"><pre><div class="line">RSAAuthentication yes</div><div class="line">PubkeyAuthentication yes</div><div class="line"><span class="comment"># yes 代表开启密匙登陆</span></div></pre></td></tr></table></figure><p></p><p>然后重启SSH：<br></p><figure class="highlight php"><table><tr><td class="code"><pre><div class="line">service ssh restart</div><div class="line"><span class="comment"># 如果这个提示没有找到服务，那么试试 service sshd restart</span></div></pre></td></tr></table></figure><p></p><h4 id="配置客户端私匙"><a href="#配置客户端私匙" class="headerlink" title="配置客户端私匙"></a>配置客户端私匙</h4><p>服务器配置完毕，我们还需要配置SSH连接客户端。<br>私匙取回本地<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">cat id_rsa</div></pre></td></tr></table></figure><p></p><p>在本地电脑上面新建一个文本文件，并把屏幕上面的密匙复制出来写入文件内，<br>文件取名为 id_rsa （这个名称随意，但这个密匙文件一定要保存好！）。<br></p><figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 密匙文件就像这样</span></div><div class="line"> </div><div class="line">-----BEGIN RSA <span class="keyword">PRIVATE</span> KEY-----</div><div class="line">Proc-Type: <span class="number">4</span>,ENCRYPTED</div><div class="line">DEK-Info: AES<span class="number">-128</span>-CBC,EA47822BC49A9E56338A99D07084DA38</div><div class="line">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div><div class="line">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div><div class="line">XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX</div><div class="line">...</div><div class="line">...</div><div class="line">-----END RSA <span class="keyword">PRIVATE</span> KEY-----</div></pre></td></tr></table></figure><p></p><p>然后我们打开SSH连接客户端，导入私匙。</p><ul><li><code>ssh客户端私匙导入方法...略</code></li></ul><h4 id="关闭密码登陆方式"><a href="#关闭密码登陆方式" class="headerlink" title="关闭密码登陆方式"></a>关闭密码登陆方式</h4><p>如果你ssh能用私匙登陆,那就可以关闭用密码登陆避免被人暴力破解密码</p><p>打开 SSH的配置文件，找到下面这个参数。<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">vi /etc/ssh/sshd_config</div></pre></td></tr></table></figure><p></p><figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="comment"># 默认这个参数选项就是 no，如果不是则改为 no，如果前面有 注释符# 那么就去掉 #</span></div><div class="line">PasswordAuthentication no</div></pre></td></tr></table></figure><p>最后重启SSH：<br></p><figure class="highlight php"><table><tr><td class="code"><pre><div class="line">service ssh restart</div><div class="line"><span class="comment"># 如果这个提示没有找到服务，那么试试 service sshd restart</span></div></pre></td></tr></table></figure><p></p><ul><li><h2 id="其他说明"><a href="#其他说明" class="headerlink" title="其他说明"></a><code>其他说明</code></h2></li></ul><h3 id="多服务器共用同一个密匙"><a href="#多服务器共用同一个密匙" class="headerlink" title="多服务器共用同一个密匙"></a>多服务器共用同一个密匙</h3><p>当你有很多服务器，每个服务器一个单独的密匙太麻烦，那么你可以多个服务器共用一个密匙。<br>公匙位置也是和上面教程说的一样,假设我们是ROOT用户,那么在/root目录下新建一个.ssh目录：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">mkdir /root/.ssh</div></pre></td></tr></table></figure><p></p><p>然后把你的一个公匙（authorized_keys）通过FTP/SFTP上传到其他服务器的 /root/.ssh 目录内<br>或通过读取并写入的方式来写入其他服务器的 /root/.ssh 目录内<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">cat authorized_keys</div></pre></td></tr></table></figure><p></p><p>在服务器上面读取你的 公匙文件内容，如果是在本地直接打开复制内容即可<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">echo -e &quot;xxxx&quot; &gt; /root/.ssh/authorized_keys</div></pre></td></tr></table></figure><p></p><p>然后把上面代码的 xxxx 改为你复制的公匙文件内容，然后用上面的命令写入到 /root/.ssh/authorized_keys 文件内。<br>然后再根据上面的 教程配置SSH即可。</p><p><a href="https://doub.io/linux-jc9/" target="_blank" rel="external">资料来源自逗逼网</a><br><a href="https://wiki.centos.org/zh/HowTos/Network/SecuringSSH" target="_blank" rel="external">centos资料</a></p></div><footer><div class="tags"><a class="tags-link" href="/tags/vps/">vps</a></div><div class="clearfix"></div></footer></article></div></div><footer id="footer"><div class="copyright">&copy; 2017 <a href="/">(^_^)</a></div><div class="theme-copyright">Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a> | Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a></div><div class="clearfix"></div></footer><script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/all.js"></script></body><!-- rebuild by neat -->