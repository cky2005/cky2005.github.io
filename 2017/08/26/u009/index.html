<!-- build time:Thu Oct 19 2017 14:39:58 GMT+0800 (中国标准时间) --><!DOCTYPE HTML><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="chrome=1"><div id="squ-side"><div class="squ-sidec"><div style="text-align:left"><a href="javascript:scroll(0,0)"><font size="6">▲</font></a> <a href="/about/index.html"><i class="icon-copy icon-2x"></i></a> <a href="/index.html"><i class="icon-home icon-2x"></i></a></div></div><div class="squ-sideb"><div class="b">?</div></div></div><title>Linux中利用 iptables string模块 屏蔽泛域名(匹配字符串) | 唔多阁</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="author" content="(^_^)"><meta name="description" content="一些人不想让别人用$$账号访问指定域名，但是通过Hosts屏蔽域名的话比较麻烦，"><meta name="description" content="一些人不想让别人用$$账号访问指定域名，但是通过Hosts屏蔽域名的话比较麻烦，"><meta property="og:type" content="article"><meta property="og:title" content="Linux中利用 iptables string模块 屏蔽泛域名(匹配字符串)"><meta property="og:url" content="https://www.233666.org/2017/08/26/u009/index.html"><meta property="og:site_name" content="唔多阁"><meta property="og:description" content="一些人不想让别人用$$账号访问指定域名，但是通过Hosts屏蔽域名的话比较麻烦，"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2017-09-16T11:40:33.070Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Linux中利用 iptables string模块 屏蔽泛域名(匹配字符串)"><meta name="twitter:description" content="一些人不想让别人用$$账号访问指定域名，但是通过Hosts屏蔽域名的话比较麻烦，"><link rel="icon" type="image/x-icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"></head></html><body><div class="wrapper"><header id="header"><div class="title"><h1><a href="/">唔多阁</a></h1><p><a href="/">(学习笔记,备忘,纯属复制粘贴,无技术含量)</a></p></div><nav class="nav"><ul></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div class="content"><article class="post"><header><div class="icon"></div><a href="/2017/08/26/u009/"><time datetime="2017-08-26T03:47:00.000Z">2017-08-26</time></a><h1 class="title">Linux中利用 iptables string模块 屏蔽泛域名(匹配字符串)</h1></header><div class="entry"><p>一些人不想让别人用$$账号访问指定域名，但是通过Hosts屏蔽域名的话比较麻烦，<a id="more"></a><br>Shadowsocks服务端是启动的时候才会读取Hosts，所以每次修改都需要重启$$服务端，<br>并且Hosts的方法屏蔽域名，只支持单域名，并不支持泛域名，很不方便。<br>所以我简单查了一下，找到了一个通过iptables防火墙匹配字符串的方法，那就是 string 模块。</p><p>一般 iptables 自带的都有 string 模块，这个模块的作用就是匹配字符串，<br>匹配到泛域名的URL，然后就把数据包丢弃，就实现了屏蔽泛域名的功能。</p><p>示例：<br>以下规则是屏蔽以 <code>youtube.com</code> 为主的所有一级 二级 三级等域名。<br></p><figure class="highlight php"><table><tr><td class="code"><pre><div class="line">iptables -I OUTPUT -m string --string <span class="string">"youtube.com"</span> --algo bm --to <span class="number">65535</span> -j DROP</div><div class="line"><span class="comment"># 添加屏蔽规则</span></div><div class="line"> iptables -D OUTPUT -m string --string <span class="string">"youtube.com"</span> --algo bm --to <span class="number">65535</span> -j DROP</div><div class="line"><span class="comment"># 删除屏蔽规则，上面添加的代码是什么样，那么删除的代码就是把 -I 改成 -D</span></div></pre></td></tr></table></figure><p></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">解释：</div><div class="line">-I 是插入iptables规则；</div><div class="line">-D 是删除对应的iptables规则；</div><div class="line">-m string 是指定模块；</div><div class="line">–string “youtube.com” 是指定要匹配的字符串(域名)；</div><div class="line">–algo bm 是指定匹配字符串模式/算法；</div><div class="line">–to 65535 是指定端口，这里代表所有端口；</div><div class="line">-j DROP 是指匹配到数据包后处理方式，这里是丢弃数据包。</div></pre></td></tr></table></figure><p>这个模块的作用就是匹配字符串，这个字符串可以是URL，也可以是普通文本，也可以是文件后缀，<br>比如： .zip ，就会把包含 .zip 的数据库丢弃，这样就会无法下载 .zip 类型的文件了！<br>其他的作用大家可以慢慢研究。</p><p><a href="https://doub.io/wlzy-25/" target="_blank" rel="external">转载自逗逼网</a></p></div><footer><div class="clearfix"></div></footer></article></div></div><footer id="footer"><div class="copyright">&copy; 2017 <a href="/">(^_^)</a></div><div class="theme-copyright"><a href="javascript:scroll(0,0)">返回顶部</a></div><div class="clearfix"></div></footer><script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/all.js"></script><script type="text/javascript">$(document).ready(function(){$(document).on("click",".fold_hider",function(){$(">.fold",this.parentNode).slideToggle(),$(">:first",this).toggleClass("open")}),$("div.fold").css("display","none")})</script></body><!-- rebuild by neat -->