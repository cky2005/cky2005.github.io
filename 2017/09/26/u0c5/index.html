<!-- build time:Sat Sep 30 2017 13:43:49 GMT+0800 (中国标准时间) --><!DOCTYPE HTML><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="chrome=1"><div class="r_menu"><a href="/index.html"><i class="icon-home icon-2x"></i></a></div><div class="r1_menu"><i class="icon-circle-arrow-left icon-2x" onclick="history.back()"></i></div><div class="r2_menu"><i class="icon-circle-arrow-right icon-2x" onclick="window.history.forward()"></i></div><style type="text/css">a:hover{color:#b00}#squ-side{width:70px;height:auto;margin:0;position:fixed;background:0 0;z-index:999999;overflow:hidden;top:50%;left:-40px;-webkit-transition:.5s ease-in-out;-moz-transition:.5s ease-in-out;-o-transition:.5s ease-in-out}.squ-sidec{float:left;width:30px;border:2px solid #ccc;border-radius:.5em .5em .5em .5em;box-shadow:0 5px 5px #565656;-webkit-box-shadow:0 5px 5px #565656;-moz-box-shadow:0 5px 5px #565656;-o-box-shadow:0 5px 5px #565656}.squ-sideb{float:right;width:25px}.squ-sideb .b{width:22px;height:20px;border-radius:50%;text-align:center;box-shadow:0 5px 5px #565656;-webkit-box-shadow:0 5px 5px #565656;-moz-box-shadow:0 5px 5px #565656;-o-box-shadow:0 5px 5px #565656}#squ-side:hover{left:0}#squ-side:hover .squ-sideb .b{opacity:0;filter:alpha(opacity=0)}</style><div id="squ-side"><div class="squ-sidec"><div style="text-align:left"><a href="https://www.weibo.com"><i class="icon-weibo icon-2x"></i></a><br><a href="https://www.tumblr.com"><i class="icon-tumblr icon-2x"></i></a><br><a href="https://www.twitter.com"><i class="icon-twitter-sign icon-2x"></i></a><br><a href="/about/index.html"><i class="icon-tags icon-2x"></i></a></div></div><div class="squ-sideb"><div class="b">?</div></div></div><title>mongoDB限制连接 | 唔多阁</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="author" content="(^_^)"><meta name="description" content="MongoDB限制内网访问的方法"><meta name="description" content="MongoDB限制内网访问的方法"><meta property="og:type" content="article"><meta property="og:title" content="mongoDB限制连接"><meta property="og:url" content="https://www.233666.org/2017/09/26/u0c5/index.html"><meta property="og:site_name" content="唔多阁"><meta property="og:description" content="MongoDB限制内网访问的方法"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2017-09-26T03:27:29.173Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="mongoDB限制连接"><meta name="twitter:description" content="MongoDB限制内网访问的方法"><link rel="icon" type="image/x-icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"></head></html><body><div class="wrapper"><header id="header"><div class="title"><h1><a href="/">唔多阁</a></h1><p><a href="/">(学习笔记,备忘,纯属复制粘贴,无技术含量)</a></p></div><nav class="nav"><ul></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div class="content"><article class="post"><header><div class="icon"></div><a href="/2017/09/26/u0c5/"><time datetime="2017-09-26T04:00:17.000Z">2017-09-26</time></a><h1 class="title">mongoDB限制连接</h1></header><div class="entry"><h4 id="MongoDB限制内网访问的方法"><a href="#MongoDB限制内网访问的方法" class="headerlink" title="MongoDB限制内网访问的方法"></a>MongoDB限制内网访问的方法<a id="more"></a></h4><p>首先查看了一下MongoDB的文档，发现mongodb在启动服务后，在默认情况下，是允许所有IP访问的，而且没有密码。也就是说在任何电脑上，通过以下命令都是可以直接连接MongoDB的：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">mongo xxx.xxx.xxx.xxx</div></pre></td></tr></table></figure><p></p><p>好吧，这个真的好危险.MongoDB限制访问的方法，总结来说大概有以下三种方法：</p><h4 id="一、限制访问IP和端口"><a href="#一、限制访问IP和端口" class="headerlink" title="一、限制访问IP和端口"></a>一、限制访问IP和端口</h4><p>MongoDB可以限制只允许某一特定IP来访问，只要在启动时加一个参数bind_ip即可，或者在/etc/mongodb.conf中添加bind_ip配置，如下:<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># 方法一</div><div class="line">mongod --bind_ip 127.0.0.1,10.0.133.14</div><div class="line"> </div><div class="line"># 方法二 在/etc/mongodb.conf文件中添加以下内容：</div><div class="line">bind_ip = 127.0.0.1,10.0.133.14</div></pre></td></tr></table></figure><p></p><p>这样之后，MongoDB服务端只有127.0.0.1和10.0.133.14这两个 IP 可以访问了。</p><p>MongoDB默认的监听端口是27017，为了安全起见，你可以修改这个监听端口，避免恶意的连接尝试。修改方法同样有两种，如下：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># 方法一</div><div class="line">mongod --bind_ip 127.0.0.1,10.0.133.14 --port 28018</div><div class="line"> </div><div class="line"># 方法二 在/etc/mongodb.conf文件中添加以下内容：</div><div class="line">port = 28018</div></pre></td></tr></table></figure><p></p><p>客户端访问时不指定端口会连接到默认端口27017。当你修改了MongoDB服务端的端口后，客户端连接MongoDB时需要指定端口号，如：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">mongo xxx.xxx.xxx.xxx:28018</div></pre></td></tr></table></figure><p></p><h4 id="二、设置用户名和密码"><a href="#二、设置用户名和密码" class="headerlink" title="二、设置用户名和密码"></a>二、设置用户名和密码</h4><p>MongoDB在默认的情况下启动时是没有用户名和密码的验证的，如果你需要使用密码验证功能，可以通过下面两种方式打开：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># 启动mongodb时加上--auth</div><div class="line">sudo mongod --auth</div><div class="line"> </div><div class="line"># 修改/etc/mongodb.conf配置文件</div><div class="line"># 将auth = True这一行的注释去掉，保存文件，重启mongodb即可</div></pre></td></tr></table></figure><p></p><p>而admin.system.users中保存了admin用户的信息。<br>MongoDB中的用户分为超级用户(super user)和普通的数据库用户(database user)：<br>超级用户存放在admin数据库中(在MongoDB的初始情况下，admin数据库默认是空的)，这<br>种用户拥有最大权限，可以对所有数据库进行任意操作；数据库用户则是存放在另外的数<br>据库中，这种用户只能访问自己的数据库。所有的用户信息都存放在自己数据库的<br>system.users表中。在MongoDB中创建用户非常简单，如下：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># 创建Admin用户</div><div class="line">mongo</div><div class="line">use admin</div><div class="line">db.addUser(&apos;super&apos;, &apos;123456&apos;)</div><div class="line"> </div><div class="line"># 创建普通用户</div><div class="line">mongo</div><div class="line">use test</div><div class="line">db.addUser(&apos;test_user&apos;, &apos;123456&apos;)</div></pre></td></tr></table></figure><p></p><p>以上的创建方式是基于MongoDB 2.4.x版本，最新版的2.6.x中创建用户的方法会有所不同，具体的方法见MongoDB官方文档：add mongodb user<br>在MongoDB中，用户和权限有以下特性：</p><ol><li>数据库是由超级用户来创建的，一个数据库可以包含多个用户，一个用户只能在一个数据库下，不同数据库中的用户可以同名；</li><li>如果在 admin 数据库中不存在用户，即使 mongod 启动时添加了 –auth参数，此时不进行任何认证还是可以做任何操作；</li><li>在 admin 数据库创建的用户具有超级权限，可以对 MongoDB 系统内的任何数据库的数据对象进行操作；</li><li>特定数据库比如 test1 下的用户 test_user1，不能够访问其他数据库 test2，但是可以访问本数据库下其他用户创建的数据；</li><li>不同数据库中同名的用户不能够登录其他数据库。比如数据库 test1 和 test2 都有用户 test_user，以 test_user 登录 test1 后,不能够登录到 test2 进行数据库操作</li></ol><h4 id="三、使用Linux-IPtables限制IP范围"><a href="#三、使用Linux-IPtables限制IP范围" class="headerlink" title="三、使用Linux IPtables限制IP范围"></a>三、使用Linux IPtables限制IP范围</h4><p>这种方法和MongoDB本身没有关系，而是借用Linux的iptables功能，限制允许访问MongoDB端口的IP地址，具体的做法如下：<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># 拒绝所有访问27017端口的请求</div><div class="line">sudo iptables -I INPUT -p tcp --dport 27017 -j DROP</div><div class="line"># 允许本地访问mongo端口</div><div class="line">sudo iptables -I INPUT -s 127.0.0.1 -p tcp --dport 27017 -j ACCEPT</div><div class="line"># 修改iptables规则后 保存规则 </div><div class="line">sudo iptables-save</div></pre></td></tr></table></figure><p></p><p>OK，这样就只允许通过本地访问MongoDB服务了。</p></div><footer><div class="clearfix"></div></footer></article></div></div><footer id="footer"><div class="copyright">&copy; 2017 <a href="/">(^_^)</a></div><div class="theme-copyright">Theme by <a href="https://github.com/orderedlist" target="_blank">orderedlist</a> | Redesign by <a href="http://heroicyang.com/" target="_blank">Heroic Yang</a></div><div class="clearfix"></div></footer><script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/all.js"></script></body><!-- rebuild by neat -->