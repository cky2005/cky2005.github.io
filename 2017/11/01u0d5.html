<!-- build time:Sat Nov 25 2017 19:36:01 GMT+0800 (中国标准时间) --><!DOCTYPE HTML><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="chrome=1"><div id="squ-side"><div class="squ-sidec"><div style="text-align:left"><a href="javascript:scroll(0,0)"><font size="6">▲</font></a> <a href="/archives/index.html"><i class="icon-copy icon-2x"></i></a> <a href="/index.html"><i class="icon-home icon-2x"></i></a></div></div><div class="squ-sideb"><div class="b">?</div></div></div><title>linux 脚本笔记 | 唔多阁</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="author" content="(^_^)"><meta property="og:type" content="article"><meta property="og:title" content="linux 脚本笔记"><meta property="og:url" content="https://www.233666.org/2017/11/01u0d5.html"><meta property="og:site_name" content="唔多阁"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2017-10-31T16:53:20.116Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="linux 脚本笔记"><link rel="icon" type="image/x-icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"></head></html><body><div class="wrapper"><header id="header"><div class="title"><h1><a href="/">唔多阁</a></h1><p><a href="/">(学习笔记,备忘,纯属复制粘贴,无技术含量)</a></p></div><nav class="nav"><ul></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div class="content"><article class="post"><header><div class="icon"></div><a href="/2017/11/01u0d5.html"><time datetime="2017-10-31T16:00:17.000Z">2017-11-01</time></a><h1 class="title">linux 脚本笔记</h1></header><div class="entry"><a id="more"></a><h4 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># NOTE: `uname -m` is more accurate and universal than `arch`</div><div class="line"># See https://en.wikipedia.org/wiki/Uname</div><div class="line">unamem=&quot;$(uname -m)&quot;</div><div class="line">if [[ $unamem == *aarch64* ]]; then</div><div class="line">	s_arch=&quot;arm64&quot;</div><div class="line">elif [[ $unamem == *64* ]]; then</div><div class="line">	s_arch=&quot;amd64&quot;</div><div class="line">elif [[ $unamem == *86* ]]; then</div><div class="line">	s_arch=&quot;386&quot;</div><div class="line">elif [[ $unamem == *armv5* ]]; then</div><div class="line">	s_arch=&quot;arm&quot;</div><div class="line">	s_arm=&quot;5&quot;</div><div class="line">elif [[ $unamem == *armv6l* ]]; then</div><div class="line">	s_arch=&quot;arm&quot;</div><div class="line">	s_arm=&quot;6&quot;</div><div class="line">elif [[ $unamem == *armv7l* ]]; then</div><div class="line">	s_arch=&quot;arm&quot;</div><div class="line">	s_arm=&quot;7&quot;</div><div class="line">else</div><div class="line">	echo &quot;Aborted, unsupported or unknown architecture: $unamem&quot;</div><div class="line">	return 2</div><div class="line">fi</div><div class="line">&nbsp</div><div class="line">unameu=&quot;$(tr &apos;[:lower:]&apos; &apos;[:upper:]&apos; &lt;&lt;&lt;$(uname))&quot;</div><div class="line">if [[ $unameu == *DARWIN* ]]; then</div><div class="line">	s_os=&quot;darwin&quot;</div><div class="line">	s_dl_ext=&quot;.zip&quot;</div><div class="line">	vers=$(sw_vers)</div><div class="line">	version=$&#123;vers##*ProductVersion:&#125;</div><div class="line">	IFS=&apos;.&apos; read OSX_MAJOR OSX_MINOR _ &lt;&lt;&lt;&quot;$version&quot;</div><div class="line">&nbsp</div><div class="line">	# Major</div><div class="line">	if ((OSX_MAJOR &lt; 10)); then</div><div class="line">		echo &quot;Aborted, unsupported OS X version (9-)&quot;</div><div class="line">		return 3</div><div class="line">	fi</div><div class="line">	if ((OSX_MAJOR &gt; 10)); then</div><div class="line">		echo &quot;Aborted, unsupported OS X version (11+)&quot;</div><div class="line">		return 4</div><div class="line">	fi</div><div class="line">&nbsp</div><div class="line">	# Minor</div><div class="line">	if ((OSX_MINOR &lt; 5)); then</div><div class="line">		echo &quot;Aborted, unsupported OS X version (10.5-)&quot;</div><div class="line">		return 5</div><div class="line">	fi</div><div class="line">elif [[ $unameu == *LINUX* ]]; then</div><div class="line">	s_os=&quot;linux&quot;</div><div class="line">elif [[ $unameu == *FREEBSD* ]]; then</div><div class="line">	s_os=&quot;freebsd&quot;</div><div class="line">elif [[ $unameu == *OPENBSD* ]]; then</div><div class="line">	s_os=&quot;openbsd&quot;</div><div class="line">elif [[ $unameu == *WIN* || $unameu == MSYS* ]]; then</div><div class="line">	# Should catch cygwin</div><div class="line">	sudo_cmd=&quot;&quot;</div><div class="line">	s_os=&quot;windows&quot;</div><div class="line">	s_dl_ext=&quot;.zip&quot;</div><div class="line">	s_bin=$s_bin.exe</div><div class="line">else</div><div class="line">	echo &quot;Aborted, unsupported or unknown os: $uname&quot;</div><div class="line">	return 6</div><div class="line">fi</div></pre></td></tr></table></figure><h4 id="ip"><a href="#ip" class="headerlink" title="ip"></a>ip</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># Get public IP address</div><div class="line">IP=$(ip addr | egrep -o &apos;[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;&apos; | egrep -v &quot;^192\.168|^172\.1[6-9]\.|^172\.2[0-9]\.|^172\.3[0-2]\.|^10\.|^127\.|^255\.|^0\.&quot; | head -n 1)</div><div class="line">if [[ &quot;$IP&quot; = &quot;&quot; ]]; then</div><div class="line">    IP=$(wget -qO- -t1 -T2 ipv4.icanhazip.com)</div><div class="line">fi</div></pre></td></tr></table></figure><h4 id="check-root"><a href="#check-root" class="headerlink" title="check root"></a>check root</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># Make sure only root can run our script</div><div class="line">function rootness()&#123;</div><div class="line">    if [[ $EUID -ne 0 ]]; then</div><div class="line">       echo &quot;Error:This script must be run as root!&quot; 1&gt;&amp;2</div><div class="line">       exit 1</div><div class="line">    fi</div><div class="line">&#125;</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">ip=$(wget -qO- -t1 -T2 ipinfo.io/ip)</div><div class="line">if [[ -z &quot;$&#123;ip&#125;&quot; ]]; then</div><div class="line">  ip=$(wget -qO- -t1 -T2 api.ip.sb/ip)</div><div class="line">  if [[ -z &quot;$&#123;ip&#125;&quot; ]]; then</div><div class="line">    ip=$(wget -qO- -t1 -T2 members.3322.org/dyndns/getip)</div><div class="line">    if [[ -z &quot;$&#123;ip&#125;&quot; ]]; then</div><div class="line">      ip=&quot;VPS_IP&quot;</div><div class="line">    fi</div><div class="line">  fi</div><div class="line">fi</div></pre></td></tr></table></figure><h4 id="当前目录"><a href="#当前目录" class="headerlink" title="当前目录"></a>当前目录</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line"># 显示当前目录</div><div class="line">pwd</div><div class="line">#Current folder</div><div class="line">cur_dir=`pwd`</div><div class="line">#Current folder</div><div class="line">EXEPATH=$(cd `dirname $0`;pwd)</div><div class="line">echo &quot;$EXEPATH&quot;</div></pre></td></tr></table></figure><h4 id="cat-新建-覆盖-在后面添加"><a href="#cat-新建-覆盖-在后面添加" class="headerlink" title="cat 新建/覆盖/在后面添加"></a>cat 新建/覆盖/在后面添加</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">从命令行直接编辑新建/覆盖xxx.txt文件</div><div class="line">cat &gt; xxx.txt</div><div class="line">&gt; xxxx</div><div class="line">&gt; xxx</div><div class="line"># CTRL + D 保存退出, CTRL + C 中断退出</div><div class="line"># 在xxx.txt文件内容后面添加</div><div class="line">cat &gt;&gt; xxx.txt</div></pre></td></tr></table></figure><h3 id="函数1"><a href="#函数1" class="headerlink" title="函数1"></a>函数1</h3><figure class="highlight php"><table><tr><td class="code"><pre><div class="line">input () &#123;</div><div class="line">  read -p <span class="string">"请输入$2,默认($3):"</span> $<span class="number">1</span></div><div class="line">  <span class="keyword">eval</span> $&#123;<span class="number">1</span>&#125;=$&#123;!<span class="number">1</span>:-$<span class="number">3</span>&#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">#使用</span></div><div class="line">input <span class="string">"变量"</span> <span class="string">"提示"</span> <span class="string">"默认"</span></div></pre></td></tr></table></figure><h3 id="判断输入0至1-不正确继续循环"><a href="#判断输入0至1-不正确继续循环" class="headerlink" title="判断输入0至1,不正确继续循环"></a>判断输入0至1,不正确继续循环</h3><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">while :; do </div><div class="line">	read -p &quot;输入数字（0关闭 ,1开启）:&quot; level</div><div class="line">    if [[ $level != [0-1] ]]; then</div><div class="line">		echo &quot;输入错误! 请输入正确的数字!&quot;</div><div class="line">	elif [[ $level == &quot;0&quot; ]]; then</div><div class="line">	    echo &quot;输入了0&quot;</div><div class="line">	    break</div><div class="line">	elif [[ $level == &quot;1&quot; ]]; then</div><div class="line">	    echo &quot;输入了1&quot;</div><div class="line">	    break</div><div class="line">	fi</div><div class="line">done</div></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">input ()&#123;</div><div class="line">while :; do </div><div class="line">	read -p &quot;输入$2$3:&quot; $1</div><div class="line">    if [[ $&#123;!1&#125; != [$&#123;3&#125;] ]]; then</div><div class="line">		echo &quot;输入错误! 请输入正确的数字!&quot;</div><div class="line">	else</div><div class="line">	    break</div><div class="line">	fi</div><div class="line">done</div><div class="line">&#125;</div><div class="line">#使用(数字/字母单词:可以用0-9,1,2,3,a-z,a,b,c这些)</div><div class="line">input &quot;变量名字&quot; &quot;提示&quot; &quot;数字/字母单词&quot;</div></pre></td></tr></table></figure><h3 id="加减乘除-http-blog-csdn-net-taijianyu-article-details-6907288"><a href="#加减乘除-http-blog-csdn-net-taijianyu-article-details-6907288" class="headerlink" title="加减乘除 http://blog.csdn.net/taijianyu/article/details/6907288"></a>加减乘除 <a href="http://blog.csdn.net/taijianyu/article/details/6907288" target="_blank" rel="external">http://blog.csdn.net/taijianyu/article/details/6907288</a></h3><p>shell 包含三个命令：bc、expr、let可用于数值计算。<br>输入：整数，let和expr都无法进行浮点运算，但是bc和awk可以。<br>输出：bc、expr可直接显示计算结果；let则丢弃计算结果，可通过传递结果到变量，取变量值获得计算结果。<br></p><figure class="highlight php"><table><tr><td class="code"><pre><div class="line"><span class="comment">#乘(\*)要加个"\",数字和运算符之间要有空格</span></div><div class="line">a=`expr <span class="number">1</span> + <span class="number">1</span>` 或 ((a=<span class="number">1</span>+<span class="number">1</span>)) 或 a=$[<span class="number">1</span>+<span class="number">1</span>]</div><div class="line"><span class="keyword">echo</span> $a</div><div class="line">c=`expr <span class="number">2</span> \* <span class="number">2</span>` 或 ((c=<span class="number">2</span>*<span class="number">2</span>)) 或 a=$[<span class="number">1</span>*<span class="number">1</span>]</div><div class="line"><span class="keyword">echo</span> `expr <span class="number">10</span> / <span class="number">2</span>`</div><div class="line"><span class="comment">#乘(*)let传递结果到变量a</span></div><div class="line">let a=<span class="number">2</span>*<span class="number">2</span> 或者 let <span class="string">"a = 2 * 2"</span></div><div class="line">&nbsp</div><div class="line">— +：对两个变量做加法。</div><div class="line">— -：对两个变量做减法。</div><div class="line">— *：对两个变量做乘法。</div><div class="line">— /：对两个变量做除法。</div><div class="line">— **：对两个变量做幂运算。</div><div class="line">— %：取模运算，第一个变量除以第二个变量求余数。</div><div class="line">— +=：加等于，在自身基础上加第二个变量。</div><div class="line">— -=：减等于，在第一个变量的基础上减去第二个变量。</div><div class="line">— *=：乘等于，在第一个变量的基础上乘以第二个变量。</div><div class="line">— /=：除等于，在第一个变量的基础上除以第二个变量。</div><div class="line">— %=：取模赋值，第一个变量对第二个变量取模运算，再赋值给第一个变量。</div></pre></td></tr></table></figure><p></p></div><footer><div class="clearfix"></div></footer></article><div class="comments" id="comments"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine/dist/Valine.min.js"></script><script>new Valine({av:AV,el:".comments",verify:!0,guest_info:["nick","mail"],app_id:"58Gw4yI8F0oqW6c8XmlSf41L-gzGzoHsz",app_key:"x9x1YOCqBJlFS4cCmNEQNhgg",placeholder:"--有问题请在此留言--"})</script></div></div><footer id="footer"><div class="copyright">&copy; 2017 <a href="/">(^_^)</a></div><div class="theme-copyright"><a href="javascript:scroll(0,0)">返回顶部</a></div><div class="clearfix"></div></footer><script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/all.js"></script><script type="text/javascript">$(document).ready(function(){$(document).on("click",".fold_hider",function(){$(">.fold",this.parentNode).slideToggle(),$(">:first",this).toggleClass("open")}),$("div.fold").css("display","none")})</script></body><!-- rebuild by neat -->