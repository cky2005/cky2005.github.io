<!-- build time:Thu Feb 14 2019 22:36:43 GMT+0800 (GMT+08:00) --><!DOCTYPE HTML><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="chrome=1"><title>linux 脚本笔记 | 唔多阁</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="author" content="(^_^)"><meta property="og:type" content="article"><meta property="og:title" content="linux 脚本笔记"><meta property="og:url" content="https://cky2005.github.io/2017/11/01u0d5.html"><meta property="og:site_name" content="唔多阁"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2017-10-31T16:53:20.116Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="linux 脚本笔记"><link rel="icon" type="image/x-icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"></head></html><body><div class="wrapper"><header id="header"><div class="title"><h1><a href="/">唔多阁</a></h1><p><a href="/">(学习笔记,备忘,纯属复制粘贴,无技术含量)</a></p></div><nav class="nav"><ul></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div class="content"><article class="post"><header><div class="icon"></div><a href="/2017/11/01u0d5.html"><time datetime="2017-10-31T16:00:17.000Z">2017-11-01</time></a><h1 class="title">linux 脚本笔记</h1></header><div class="entry"><a id="more"></a><h4 id="系统"><a href="#系统" class="headerlink" title="系统"></a>系统</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># NOTE: `uname -m` is more accurate and universal than `arch`</span><br><span class="line"># See https://en.wikipedia.org/wiki/Uname</span><br><span class="line">unamem=&quot;$(uname -m)&quot;</span><br><span class="line">if [[ $unamem == *aarch64* ]]; then</span><br><span class="line">	s_arch=&quot;arm64&quot;</span><br><span class="line">elif [[ $unamem == *64* ]]; then</span><br><span class="line">	s_arch=&quot;amd64&quot;</span><br><span class="line">elif [[ $unamem == *86* ]]; then</span><br><span class="line">	s_arch=&quot;386&quot;</span><br><span class="line">elif [[ $unamem == *armv5* ]]; then</span><br><span class="line">	s_arch=&quot;arm&quot;</span><br><span class="line">	s_arm=&quot;5&quot;</span><br><span class="line">elif [[ $unamem == *armv6l* ]]; then</span><br><span class="line">	s_arch=&quot;arm&quot;</span><br><span class="line">	s_arm=&quot;6&quot;</span><br><span class="line">elif [[ $unamem == *armv7l* ]]; then</span><br><span class="line">	s_arch=&quot;arm&quot;</span><br><span class="line">	s_arm=&quot;7&quot;</span><br><span class="line">else</span><br><span class="line">	echo &quot;Aborted, unsupported or unknown architecture: $unamem&quot;</span><br><span class="line">	return 2</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">unameu=&quot;$(tr &apos;[:lower:]&apos; &apos;[:upper:]&apos; &lt;&lt;&lt;$(uname))&quot;</span><br><span class="line">if [[ $unameu == *DARWIN* ]]; then</span><br><span class="line">	s_os=&quot;darwin&quot;</span><br><span class="line">	s_dl_ext=&quot;.zip&quot;</span><br><span class="line">	vers=$(sw_vers)</span><br><span class="line">	version=$&#123;vers##*ProductVersion:&#125;</span><br><span class="line">	IFS=&apos;.&apos; read OSX_MAJOR OSX_MINOR _ &lt;&lt;&lt;&quot;$version&quot;</span><br><span class="line"></span><br><span class="line">	# Major</span><br><span class="line">	if ((OSX_MAJOR &lt; 10)); then</span><br><span class="line">		echo &quot;Aborted, unsupported OS X version (9-)&quot;</span><br><span class="line">		return 3</span><br><span class="line">	fi</span><br><span class="line">	if ((OSX_MAJOR &gt; 10)); then</span><br><span class="line">		echo &quot;Aborted, unsupported OS X version (11+)&quot;</span><br><span class="line">		return 4</span><br><span class="line">	fi</span><br><span class="line"></span><br><span class="line">	# Minor</span><br><span class="line">	if ((OSX_MINOR &lt; 5)); then</span><br><span class="line">		echo &quot;Aborted, unsupported OS X version (10.5-)&quot;</span><br><span class="line">		return 5</span><br><span class="line">	fi</span><br><span class="line">elif [[ $unameu == *LINUX* ]]; then</span><br><span class="line">	s_os=&quot;linux&quot;</span><br><span class="line">elif [[ $unameu == *FREEBSD* ]]; then</span><br><span class="line">	s_os=&quot;freebsd&quot;</span><br><span class="line">elif [[ $unameu == *OPENBSD* ]]; then</span><br><span class="line">	s_os=&quot;openbsd&quot;</span><br><span class="line">elif [[ $unameu == *WIN* || $unameu == MSYS* ]]; then</span><br><span class="line">	# Should catch cygwin</span><br><span class="line">	sudo_cmd=&quot;&quot;</span><br><span class="line">	s_os=&quot;windows&quot;</span><br><span class="line">	s_dl_ext=&quot;.zip&quot;</span><br><span class="line">	s_bin=$s_bin.exe</span><br><span class="line">else</span><br><span class="line">	echo &quot;Aborted, unsupported or unknown os: $uname&quot;</span><br><span class="line">	return 6</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h4 id="ip"><a href="#ip" class="headerlink" title="ip"></a>ip</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Get public IP address</span><br><span class="line">IP=$(ip addr | egrep -o &apos;[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;\.[0-9]&#123;1,3&#125;&apos; | egrep -v &quot;^192\.168|^172\.1[6-9]\.|^172\.2[0-9]\.|^172\.3[0-2]\.|^10\.|^127\.|^255\.|^0\.&quot; | head -n 1)</span><br><span class="line">if [[ &quot;$IP&quot; = &quot;&quot; ]]; then</span><br><span class="line">    IP=$(wget -qO- -t1 -T2 ipv4.icanhazip.com)</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h4 id="check-root"><a href="#check-root" class="headerlink" title="check root"></a>check root</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># Make sure only root can run our script</span><br><span class="line">function rootness()&#123;</span><br><span class="line">    if [[ $EUID -ne 0 ]]; then</span><br><span class="line">       echo &quot;Error:This script must be run as root!&quot; 1&gt;&amp;2</span><br><span class="line">       exit 1</span><br><span class="line">    fi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">ip=$(wget -qO- -t1 -T2 ipinfo.io/ip)</span><br><span class="line">if [[ -z &quot;$&#123;ip&#125;&quot; ]]; then</span><br><span class="line">  ip=$(wget -qO- -t1 -T2 api.ip.sb/ip)</span><br><span class="line">  if [[ -z &quot;$&#123;ip&#125;&quot; ]]; then</span><br><span class="line">    ip=$(wget -qO- -t1 -T2 members.3322.org/dyndns/getip)</span><br><span class="line">    if [[ -z &quot;$&#123;ip&#125;&quot; ]]; then</span><br><span class="line">      ip=&quot;VPS_IP&quot;</span><br><span class="line">    fi</span><br><span class="line">  fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure><h4 id="当前目录"><a href="#当前目录" class="headerlink" title="当前目录"></a>当前目录</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 显示当前目录</span><br><span class="line">pwd</span><br><span class="line">#Current folder</span><br><span class="line">cur_dir=`pwd`</span><br><span class="line">#Current folder</span><br><span class="line">EXEPATH=$(cd `dirname $0`;pwd)</span><br><span class="line">echo &quot;$EXEPATH&quot;</span><br></pre></td></tr></table></figure><h4 id="cat-新建-覆盖-在后面添加"><a href="#cat-新建-覆盖-在后面添加" class="headerlink" title="cat 新建/覆盖/在后面添加"></a>cat 新建/覆盖/在后面添加</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">从命令行直接编辑新建/覆盖xxx.txt文件</span><br><span class="line">cat &gt; xxx.txt</span><br><span class="line">&gt; xxxx</span><br><span class="line">&gt; xxx</span><br><span class="line"># CTRL + D 保存退出, CTRL + C 中断退出</span><br><span class="line"># 在xxx.txt文件内容后面添加</span><br><span class="line">cat &gt;&gt; xxx.txt</span><br></pre></td></tr></table></figure><h3 id="函数1"><a href="#函数1" class="headerlink" title="函数1"></a>函数1</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">input () &#123;</span><br><span class="line">  read -p <span class="string">"请输入$2,默认($3):"</span> $<span class="number">1</span></span><br><span class="line">  <span class="keyword">eval</span> $&#123;<span class="number">1</span>&#125;=$&#123;!<span class="number">1</span>:-$<span class="number">3</span>&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#使用</span></span><br><span class="line">input <span class="string">"变量"</span> <span class="string">"提示"</span> <span class="string">"默认"</span></span><br></pre></td></tr></table></figure><h3 id="判断输入0至1-不正确继续循环"><a href="#判断输入0至1-不正确继续循环" class="headerlink" title="判断输入0至1,不正确继续循环"></a>判断输入0至1,不正确继续循环</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">while :; do </span><br><span class="line">	read -p &quot;输入数字（0关闭 ,1开启）:&quot; level</span><br><span class="line">    if [[ $level != [0-1] ]]; then</span><br><span class="line">		echo &quot;输入错误! 请输入正确的数字!&quot;</span><br><span class="line">	elif [[ $level == &quot;0&quot; ]]; then</span><br><span class="line">	    echo &quot;输入了0&quot;</span><br><span class="line">	    break</span><br><span class="line">	elif [[ $level == &quot;1&quot; ]]; then</span><br><span class="line">	    echo &quot;输入了1&quot;</span><br><span class="line">	    break</span><br><span class="line">	fi</span><br><span class="line">done</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">input ()&#123;</span><br><span class="line">while :; do </span><br><span class="line">	read -p &quot;输入$2$3:&quot; $1</span><br><span class="line">    if [[ $&#123;!1&#125; != [$&#123;3&#125;] ]]; then</span><br><span class="line">		echo &quot;输入错误! 请输入正确的数字!&quot;</span><br><span class="line">	else</span><br><span class="line">	    break</span><br><span class="line">	fi</span><br><span class="line">done</span><br><span class="line">&#125;</span><br><span class="line">#使用(数字/字母单词:可以用0-9,1,2,3,a-z,a,b,c这些)</span><br><span class="line">input &quot;变量名字&quot; &quot;提示&quot; &quot;数字/字母单词&quot;</span><br></pre></td></tr></table></figure><h3 id="加减乘除-http-blog-csdn-net-taijianyu-article-details-6907288"><a href="#加减乘除-http-blog-csdn-net-taijianyu-article-details-6907288" class="headerlink" title="加减乘除 http://blog.csdn.net/taijianyu/article/details/6907288"></a>加减乘除 <a href="http://blog.csdn.net/taijianyu/article/details/6907288" target="_blank" rel="noopener">http://blog.csdn.net/taijianyu/article/details/6907288</a></h3><p>shell 包含三个命令：bc、expr、let可用于数值计算。<br>输入：整数，let和expr都无法进行浮点运算，但是bc和awk可以。<br>输出：bc、expr可直接显示计算结果；let则丢弃计算结果，可通过传递结果到变量，取变量值获得计算结果。<br></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">#乘(\*)要加个"\",数字和运算符之间要有空格</span></span><br><span class="line">a=`expr <span class="number">1</span> + <span class="number">1</span>` 或 ((a=<span class="number">1</span>+<span class="number">1</span>)) 或 a=$[<span class="number">1</span>+<span class="number">1</span>]</span><br><span class="line"><span class="keyword">echo</span> $a</span><br><span class="line">c=`expr <span class="number">2</span> \* <span class="number">2</span>` 或 ((c=<span class="number">2</span>*<span class="number">2</span>)) 或 a=$[<span class="number">1</span>*<span class="number">1</span>]</span><br><span class="line"><span class="keyword">echo</span> `expr <span class="number">10</span> / <span class="number">2</span>`</span><br><span class="line"><span class="comment">#乘(*)let传递结果到变量a</span></span><br><span class="line">let a=<span class="number">2</span>*<span class="number">2</span> 或者 let <span class="string">"a = 2 * 2"</span></span><br><span class="line"></span><br><span class="line">— +：对两个变量做加法。</span><br><span class="line">— -：对两个变量做减法。</span><br><span class="line">— *：对两个变量做乘法。</span><br><span class="line">— /：对两个变量做除法。</span><br><span class="line">— **：对两个变量做幂运算。</span><br><span class="line">— %：取模运算，第一个变量除以第二个变量求余数。</span><br><span class="line">— +=：加等于，在自身基础上加第二个变量。</span><br><span class="line">— -=：减等于，在第一个变量的基础上减去第二个变量。</span><br><span class="line">— *=：乘等于，在第一个变量的基础上乘以第二个变量。</span><br><span class="line">— /=：除等于，在第一个变量的基础上除以第二个变量。</span><br><span class="line">— %=：取模赋值，第一个变量对第二个变量取模运算，再赋值给第一个变量。</span><br></pre></td></tr></table></figure><p></p></div><footer><div class="clearfix"></div></footer></article></div></div><footer id="footer"><div class="copyright">&copy; 2019 <a href="/">(^_^)</a></div><div class="theme-copyright"><a href="javascript:scroll(0,0)">返回顶部</a> &nbsp; <a href="/archives/index.html">档案馆</a> &nbsp; <a href="/index.html">首页</a></div><div class="clearfix"></div></footer><script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/all.js"></script><script type="text/javascript">$(document).ready(function(){$(document).on("click",".fold_hider",function(){$(">.fold",this.parentNode).slideToggle(),$(">:first",this).toggleClass("open")}),$("div.fold").css("display","none")})</script></body><!-- rebuild by neat -->