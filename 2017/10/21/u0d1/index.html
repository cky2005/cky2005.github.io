<!-- build time:Wed Oct 25 2017 11:28:16 GMT+0800 (中国标准时间) --><!DOCTYPE HTML><html><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="chrome=1"><div id="squ-side"><div class="squ-sidec"><div style="text-align:left"><a href="javascript:scroll(0,0)"><font size="6">▲</font></a> <a href="/about/index.html"><i class="icon-copy icon-2x"></i></a> <a href="/index.html"><i class="icon-home icon-2x"></i></a></div></div><div class="squ-sideb"><div class="b">?</div></div></div><title>sed很强大的文本操作命令 | 唔多阁</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="author" content="(^_^)"><meta name="description" content="sed对文本的处理很强大，并且sed非常小，参数少，容易掌握，他的操作方式根awk有点像。sed按顺序逐行读取文件。然后，它执行为该行指定的所有操作，并在完成请求的修改之后的内容显示出来，也可以存放到文件中。完成了一行上的所有操作之后，它读取文件的下一行，然后重复该过程直到它完成该文件。在这里要注意一点，源文件（默认地）保持不被修改。sed 默认读取整个文件并对其中的每一行进行修改。说白了就是一行"><meta name="description" content="sed对文本的处理很强大，并且sed非常小，参数少，容易掌握，他的操作方式根awk有点像。sed按顺序逐行读取文件。然后，它执行为该行指定的所有操作，并在完成请求的修改之后的内容显示出来，也可以存放到文件中。完成了一行上的所有操作之后，它读取文件的下一行，然后重复该过程直到它完成该文件。在这里要注意一点，源文件（默认地）保持不被修改。sed 默认读取整个文件并对其中的每一行进行修改。说白了就是一行"><meta property="og:type" content="article"><meta property="og:title" content="sed很强大的文本操作命令"><meta property="og:url" content="https://www.233666.org/2017/10/21/u0d1/index.html"><meta property="og:site_name" content="唔多阁"><meta property="og:description" content="sed对文本的处理很强大，并且sed非常小，参数少，容易掌握，他的操作方式根awk有点像。sed按顺序逐行读取文件。然后，它执行为该行指定的所有操作，并在完成请求的修改之后的内容显示出来，也可以存放到文件中。完成了一行上的所有操作之后，它读取文件的下一行，然后重复该过程直到它完成该文件。在这里要注意一点，源文件（默认地）保持不被修改。sed 默认读取整个文件并对其中的每一行进行修改。说白了就是一行"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2017-10-21T06:36:35.497Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="sed很强大的文本操作命令"><meta name="twitter:description" content="sed对文本的处理很强大，并且sed非常小，参数少，容易掌握，他的操作方式根awk有点像。sed按顺序逐行读取文件。然后，它执行为该行指定的所有操作，并在完成请求的修改之后的内容显示出来，也可以存放到文件中。完成了一行上的所有操作之后，它读取文件的下一行，然后重复该过程直到它完成该文件。在这里要注意一点，源文件（默认地）保持不被修改。sed 默认读取整个文件并对其中的每一行进行修改。说白了就是一行"><link rel="icon" type="image/x-icon" href="/img/favicon.ico"><link rel="stylesheet" href="/css/style.css"></head></html><body><div class="wrapper"><header id="header"><div class="title"><h1><a href="/">唔多阁</a></h1><p><a href="/">(学习笔记,备忘,纯属复制粘贴,无技术含量)</a></p></div><nav class="nav"><ul></ul><div class="clearfix"></div></nav><div class="clearfix"></div></header><div class="content"><article class="post"><header><div class="icon"></div><a href="/2017/10/21/u0d1/"><time datetime="2017-10-21T06:00:17.000Z">2017-10-21</time></a><h1 class="title">sed很强大的文本操作命令</h1></header><div class="entry"><p>sed对文本的处理很强大，并且sed非常小，参数少，容易掌握，他的操作方式根awk有点像。sed按顺序逐行读取文件。然后，它执行为该行指定的所有操作，并在完成请求的修改之后的内容显示出来，也可以存放到文件中。完成了一行上的所有操作之后，它读取文件的下一行，然后重复该过程直到它完成该文件。在这里要注意一点，源文件（默认地）保持不被修改。sed 默认读取整个文件并对其中的每一行进行修改。说白了就是一行一行的操作。我用sed主要就是用里面的替换功能，真的很强大。下面以实例，详细的说一下，先从替换开始，最常用的。<br><a id="more"></a></p><h4 id="一，测试文件test-讲awk时用的一样"><a href="#一，测试文件test-讲awk时用的一样" class="headerlink" title="一，测试文件test,讲awk时用的一样"></a>一，测试文件test,讲awk时用的一样</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">sed -h  </div><div class="line">-n, --quiet, --silent    取消自动打印模式空间  </div><div class="line"> -e 脚本, --expression=脚本   添加“脚本”到程序的运行列表  </div><div class="line"> -f 脚本文件, --file=脚本文件  添加“脚本文件”到程序的运行列表  </div><div class="line"> --follow-symlinks    直接修改文件时跟随软链接  </div><div class="line"> -i[扩展名], --in-place[=扩展名]    直接修改文件(如果指定扩展名就备份文件)  </div><div class="line"> -l N, --line-length=N   指定“l”命令的换行期望长度  </div><div class="line"> --posix  关闭所有 GNU 扩展  </div><div class="line"> -r, --regexp-extended  在脚本中使用扩展正则表达式  </div><div class="line"> -s, --separate  将输入文件视为各个独立的文件而不是一个长的连续输入  </div><div class="line"> -u, --unbuffered  从输入文件读取最少的数据，更频繁的刷新输出  </div><div class="line"> --help     打印帮助并退出  </div><div class="line"> --version  输出版本信息并退出</div></pre></td></tr></table></figure><p>//下面test文件的内容<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">root:x:0:0:root:/root:/bin/bash  </div><div class="line">bin:x:1:1:bin:/bin:/bin/false  </div><div class="line">daemon:x:2:2:daemon:/sbin:/bin/false  </div><div class="line">mail:x:8:12:mail:/var/spool/mail:/bin/false  </div><div class="line">ftp:x:14:11:ftp:/home/ftp:/bin/false  </div><div class="line">&amp;amp;nobody:$:99:99:nobody:/:/bin/false  </div><div class="line">zhangy:x:1000:100:,,,:/home/zhangy:/bin/bash  </div><div class="line">http:x:33:33::/srv/http:/bin/false  </div><div class="line">dbus:x:81:81:System message bus:/:/bin/false  </div><div class="line">hal:x:82:82:HAL daemon:/:/bin/false  </div><div class="line">mysql:x:89:89::/var/lib/mysql:/bin/false  </div><div class="line">aaa:x:1001:1001::/home/aaa:/bin/bash  </div><div class="line">ba:x:1002:1002::/home/zhangy:/bin/bash  </div><div class="line">test:x:1003:1003::/home/test:/bin/bash  </div><div class="line">@zhangying:*:1004:1004::/home/test:/bin/bash  </div><div class="line">policykit:x:102:1005:Po</div></pre></td></tr></table></figure><p></p><h4 id="二，举例"><a href="#二，举例" class="headerlink" title="二，举例"></a>二，举例</h4><p>1，替换功能<br></p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed &apos;s/root/tankzhang/&apos; test |grep tank  </div><div class="line"> tankzhang:x:0:0:root:/root:/bin/bash</div></pre></td></tr></table></figure><p></p><p>上面的这个例子，把test文件中的root替换成tankzhang，只不过只替换一次及终止在这一行的操作，转到下一行</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed &apos;s/root/tankzhang/g&apos; test |grep zhang  </div><div class="line"> tankzhang:x:0:0:tankzhang:/tankzhang:/bin/bash  </div><div class="line"> zhangy:x:1000:100:,,,:/home/zhangy:/bin/bash  </div><div class="line"> ba:x:1002:1002::/home/zhangy:/bin/bash  </div><div class="line"> @zhangying:*:1004:1004::/home/test:/bin/bash</div></pre></td></tr></table></figure><p>上面这个例子，用tankzhang把文件test中的root全部替换掉，请注意g这个字母，global的缩写</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -n &apos;s/root/tankzhang/p&apos; test  </div><div class="line"> tankzhang:x:0:0:root:/root:/bin/bash</div></pre></td></tr></table></figure><p>加了-n p后表示只打印那些发生替换的行（部分替换），上面的例子，我并没有加上grep</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -n &apos;s/root/tankzhang/pg&apos; test  </div><div class="line"> tankzhang:x:0:0:tankzhang:/tankzhang:/bin/bash</div></pre></td></tr></table></figure><p>加了-n pg后表示只打印那些发生替换的行（全部替换），上面的例子，我并没有加上grep</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat test | sed -ne &apos;2,8s/^zhang/ying/gp&apos;  </div><div class="line"> yingy:x:1000:100:,,,:/home/zhangy:/bin/bash</div></pre></td></tr></table></figure><p>在第二行，到第八行之间，替换以zhang开头的行，用ying来替换，并显示替换的行</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat test | sed -n  &apos;2,8s/^zhang/ying/gp;5,10s#dbus#goodbay#gp&apos;  </div><div class="line"> yingy:x:1000:100:,,,:/home/zhangy:/bin/bash  </div><div class="line"> goodbay:x:81:81:System message bus:/:/bin/false</div></pre></td></tr></table></figure><p>当有多个命令要执行时，可以用分号来分开，并且分隔符可以自定义，默认是／。上面的例子意思是在第二行，到第八行之间，替换以zhang开头的行，用ying来替换，在5，到10间，用goodbay来替换dbus，并显示替换的行</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ cat test | sed -ne &apos;2,8s/zhang/ying/gp&apos; -ne  &apos;5,10s#dbus#goodbay#gp&apos;  </div><div class="line">  </div><div class="line">yingy:x:1000:100:,,,:/home/yingy:/bin/bash  </div><div class="line"> goodbay:x:81:81:System message bus:/:/bin/false</div></pre></td></tr></table></figure><p>这个例子根上面的那个例子一样，只不过有一点不同，那就是-e来充当了分号的作用，-e也能分割多个命令。</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -ne &apos;2,8s/^\(zhangy\)/\1ing/gp&apos; test  </div><div class="line"> zhangying:x:1000:100:,,,:/home/zhangy:/bin/bash</div></pre></td></tr></table></figure><p>正则的用法，在sed里面用括号的话要加上\的，不然会报错的。</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -ne &apos;2,15s/zhang/&amp;ying/gp&apos; test  </div><div class="line"> zhangyingy:x:1000:100:,,,:/home/zhangyingy:/bin/bash  </div><div class="line"> ba:x:1002:1002::/home/zhangyingy:/bin/bash  </div><div class="line"> @zhangyingying:*:1004:1004::/home/test:/bin/bash</div></pre></td></tr></table></figure><p>＆的用处是，在找到的字符串后加上＆后面的字符串，zhang后都加上了ying</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -ne &apos;/^zhang/,/Po/s/zhang/ying/gp&apos; test  </div><div class="line"> yingy:x:1000:100:,,,:/home/yingy:/bin/bash  </div><div class="line"> ba:x:1002:1002::/home/yingy:/bin/bash  </div><div class="line"> @yingying:*:1004:1004::/home/test:/bin/bash</div></pre></td></tr></table></figure><p>上面的这个例子是说，在以zhang开头的行开始，到匹配Po的行结束，在他们之间进行替换</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed  &apos;/root/&#123;n;s/bin/tank/&#125;&apos; test  </div><div class="line"> root:x:0:0:root:/root:/bin/bash  </div><div class="line"> tank:x:1:1:bin:/bin:/bin/false</div></pre></td></tr></table></figure><p>n;这里的n是next的缩写，找到root的行后，将其下一行的中的bin换成tank</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -e &apos;1,2y/root/ROOT/&apos; test  </div><div class="line"> ROOT:x:0:0:ROOT:/ROOT:/bin/bash  </div><div class="line"> bin:x:1:1:bin:/bin:/bin/false</div></pre></td></tr></table></figure><p>y的作用是将匹配的字符换成大写，不过替换字符和被替换字符长度要一样</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -e &apos;/root/h&apos; -e &apos;$G&apos; test  </div><div class="line">  </div><div class="line">................................  </div><div class="line">  </div><div class="line">.............................  </div><div class="line">  </div><div class="line">ba:x:1002:1002::/home/zhangy:/bin/bash  </div><div class="line"> test:x:1003:1003::/home/test:/bin/bash  </div><div class="line"> @zhangying:*:1004:1004::/home/test:/bin/bash  </div><div class="line">  </div><div class="line">root:x:0:0:root:/root:/bin/bash</div></pre></td></tr></table></figure><p>这个例子中，h的作用是将找到的行，放到一个缓存区，G的作用是将缓存区中的内容放到最后一行。</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -e &apos;/root/h&apos; -e &apos;/zhangy/g&apos; test  </div><div class="line"> root:x:0:0:root:/root:/bin/bash  </div><div class="line"> bin:x:1:1:bin:/bin:/bin/false  </div><div class="line"> daemon:x:2:2:daemon:/sbin:/bin/false  </div><div class="line"> mail:x:8:12:mail:/var/spool/mail:/bin/false  </div><div class="line"> ftp:x:14:11:ftp:/home/ftp:/bin/false  </div><div class="line"> &amp;nobody:$:99:99:nobody:/:/bin/false  </div><div class="line"> root:x:0:0:root:/root:/bin/bash  </div><div class="line"> http:x:33:33::/srv/http:/bin/false  </div><div class="line"> dbus:x:81:81:System message bus:/:/bin/false  </div><div class="line"> hal:x:82:82:HAL daemon:/:/bin/false  </div><div class="line"> mysql:x:89:89::/var/lib/mysql:/bin/false  </div><div class="line"> aaa:x:1001:1001::/home/aaa:/bin/bash  </div><div class="line"> root:x:0:0:root:/root:/bin/bash  </div><div class="line"> test:x:1003:1003::/home/test:/bin/bash  </div><div class="line"> root:x:0:0:root:/root:/bin/bash</div></pre></td></tr></table></figure><p>行替换，用匹配root的行，来替换匹配zhangy的行</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -e &apos;s/bin/tank/g;3q&apos; test  </div><div class="line"> root:x:0:0:root:/root:/tank/bash  </div><div class="line"> tank:x:1:1:tank:/tank:/tank/false  </div><div class="line"> daemon:x:2:2:daemon:/stank:/tank/false</div></pre></td></tr></table></figure><p>3q的意思是到第三行的时候，退出</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -ne &apos;2,15s/zhangy.*[[:digit:]]/=======/gp&apos;  test  </div><div class="line"> =======:,,,:/home/zhangy:/bin/bash  </div><div class="line"> @=======::/home/test:/bin/bash</div></pre></td></tr></table></figure><p>匹配数字别忘了中括号外面还有一个中括号。</p><p>[:alnum:] 字母数字 [a-z A-Z 0-9]<br>[:alpha:] 字母 [a-z A-Z]<br>[:blank:] 空格或制表键<br>[:cntrl:] 任何控制字符<br>[:digit:] 数字 [0-9]<br>[:graph:] 任何可视字符（无空格）<br>[:lower:] 小写 [a-z]<br>[:print:] 非控制字符<br>[:punct:] 标点字符<br>[:space:] 空格<br>[:upper:] 大写 [A-Z]<br>[:xdigit:] 十六进制数字 [0-9 a-f A-F]</p><h4 id="二，删除"><a href="#二，删除" class="headerlink" title="二，删除"></a>二，删除</h4><p>其实我觉得吧，删除其实根替换一样，都是找出来进行一下操作而已，这个过程会牵扯到一些規则而已。</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -e &apos;1,14d&apos; test  </div><div class="line"> @zhangying:*:1004:1004::/home/test:/bin/bash  </div><div class="line"> policykit:x:102:1005:Po</div></pre></td></tr></table></figure><p>删除1，14行</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -e &apos;4,$d&apos; test  </div><div class="line"> root:x:0:0:root:/root:/bin/bash  </div><div class="line"> bin:x:1:1:bin:/bin:/bin/false  </div><div class="line"> daemon:x:2:2:daemon:/sbin:/bin/false</div></pre></td></tr></table></figure><p>删除4以后的行，包括第4行，把$当成最大行数就行了。哈哈</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -e &apos;/\(false\|bash\)$/d&apos; test  </div><div class="line"> policykit:x:102:1005:Po</div></pre></td></tr></table></figure><p>删除包括false的行，或者包括bash的行，别忘了加\</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -e &apos;/root/,/^test/d&apos; test  </div><div class="line"> @zhangying:*:1004:1004::/home/test:/bin/bash  </div><div class="line"> policykit:x:102:1005:Po</div></pre></td></tr></table></figure><p>删除从匹配root的行，到匹配以test开头的行，中间的行</p><h4 id="三，读取，追加，插入文件"><a href="#三，读取，追加，插入文件" class="headerlink" title="三，读取，追加，插入文件"></a>三，读取，追加，插入文件</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed -e &apos;/^root/r test2&apos; test  </div><div class="line"> root:x:0:0:root:/root:/bin/bash  </div><div class="line"> =============  </div><div class="line"> -------------  </div><div class="line"> +++++++++++++  </div><div class="line"> bin:x:1:1:bin:/bin:/bin/false  </div><div class="line"> daemon:x:2:2:daemon:/sbin:/bin/false</div></pre></td></tr></table></figure><p>读取test2的内容，并将其写入到匹配行的下面</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed &apos;/[[:digit:]]/w test2&apos; test</div></pre></td></tr></table></figure><p>将匹配数字的行，写入test2中</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed  &apos;/root/a\\ ===aaaa====&apos; test  </div><div class="line"> root:x:0:0:root:/root:/bin/bash  </div><div class="line"> ===aaaa====  </div><div class="line"> bin:x:1:1:bin:/bin:/bin/false</div></pre></td></tr></table></figure><p>将要插入的东西，插入匹配行的下面，</p><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed &apos;/^daemon/i\\=================&apos; test  </div><div class="line"> root:x:0:0:root:/root:/bin/bash  </div><div class="line"> bin:x:1:1:bin:/bin:/bin/false  </div><div class="line"> =================  </div><div class="line"> daemon:x:2:2:daemon:/sbin:/bin/false  </div><div class="line"> mail:x:8:12:mail:/var/spool/mail:/bin/false</div></pre></td></tr></table></figure><p>正好根a相反，将要插入的东西，插入到匹配行的上面</p><h4 id="四，调用命令文件"><a href="#四，调用命令文件" class="headerlink" title="四，调用命令文件"></a>四，调用命令文件</h4><figure class="highlight plain"><table><tr><td class="code"><pre><div class="line">$ sed  -f cmd test |awk &apos;&#123;print $0;&#125;&apos;  </div><div class="line"> tank:x:0:0:tank:/tank:/tank/bash  </div><div class="line"> tank:x:1:1:tank:/tank:/tank/false  </div><div class="line"> ba:x:1002:1002::/home/zhangy:/tank/bash  </div><div class="line"> test:x:1003:1003::/home/test:/tank/bash  </div><div class="line"> @zhangying:*:1004:1004::/home/test:/tank/bash</div></pre></td></tr></table></figure><p><a href="http://blog.51yip.com/shell/986.html" target="_blank" rel="external">来源</a></p></div><footer><div class="clearfix"></div></footer></article><div class="comments" id="comments"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//cdn.jsdelivr.net/gh/xcss/valine@v1.1.7/dist/Valine.min.js"></script><script>new Valine({av:AV,el:".comments",verify:!0,app_id:"58Gw4yI8F0oqW6c8XmlSf41L-gzGzoHsz",app_key:"x9x1YOCqBJlFS4cCmNEQNhgg",placeholder:"--有问题请留言--"})</script></div></div><footer id="footer"><div class="copyright">&copy; 2017 <a href="/">(^_^)</a></div><div class="theme-copyright"><a href="javascript:scroll(0,0)">返回顶部</a></div><div class="clearfix"></div></footer><script src="//apps.bdimg.com/libs/jquery/2.0.3/jquery.min.js"></script><script src="/js/all.js"></script><script type="text/javascript">$(document).ready(function(){$(document).on("click",".fold_hider",function(){$(">.fold",this.parentNode).slideToggle(),$(">:first",this).toggleClass("open")}),$("div.fold").css("display","none")})</script></body><!-- rebuild by neat -->